<!DOCTYPE HTML>
<html lang="en">
<head>
  <title>JD'S GAMESUITE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link rel="stylesheet" href="../css/lithium.css" title="Main Look">
  <link href="https://fonts.googleapis.com/css?family=Titillium+Web" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Fascinate+Inline" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Erica+One" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Lobster" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <script src="//cdn.jsdelivr.net/jquery.color-animation/1/mainfile"></script>
</head>
<body>

  <!-- Header ----------------------->

  <div class="top-banner">
    <div class="banner-jt">
      <h1 class="banner-title" align="center"><span class="btitle1">Game</span><span class="btitle2">Suite</span></h1>
    </div>
  </div>
  <div class="container-fluid" id="game-container">
    <header>
      <nav class="navbar navbar-inverse navbar-static-top">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://localhost:8081/">Home</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="" data-toggle="modal" data-target="#about-modal">About</a></li>
            <li><a href="#">Quit</a></li>
          </ul>
        </div>
      </nav>
    </header>
    <div id="about-modal" class="modal fade" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">About GameSuite</h4>
          </div>
          <div class="modal-body">
            <p>GameSuite is an ever-growing collection of mobile web games brought to you by the
            power of Node.js.  Start by selecting any game in the menu.  GameSuite supports
            multiple games simultaneously, and each game has a particular player limit.  To
            see the instructions for any game, select it from the main menu and tap "About".</p>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

  <!-- Main ----------------------->

    <div class="lobby-content">
      <div class="menu-view">
        <div class="lm-area">
          <div class="lm-selector"></div>
          <ul class="lobby-menu">
            <li class="lm-imposter lm-li0">Imposter</li>
            <li class="lm-pistolwhip lm-li1">Pistolwhip</li>
            <li class="lm-options lm-li2">Options</li>
          </ul>
        </div>
        <div class="gd-area">
          <div class="gd gd-imposter">
            <p>Inspired by <a href="http://spyfall.crabhat.com/">Spyfall</a>, Imposter is a game of bluffing and subtleties.<br><br>
            One person in your group is an imposter who does not belong in your scenario. Use cunning, deception, and careful questioning
            to find the Imposter before they correctly identify the scenario or run out the clock.</p>
          </div>
          <div class="gd gd-pistolwhip">
            <p class="gd-header">Pistolwhip is a WIP 2D auto-scrolling shooter. Available sooner or later.</p>
          </div>
          <div class="gd gd-options">
            <p>This is where I'd put my options... IF I HAD ANY.</p>
          </div>
        </div>
      </div>
      <div class="mvbtn-area">
	      <div class="mv-btns">
          <div class="mv-btn new-btn"><h5 class="mv-btn-label">New Game</h5></div>
          <div class="mv-btn join-btn"><h5 class="mv-btn-label">Join Game</h5></div>
          <div class="mv-btn about-btn"><h5 class="mv-btn-label">About</h5></div>
        </div>
      </div>

  <!-- Info Modals ----------------------->

      <div id="imposter-modal" class="modal fade" role="dialog">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">About Imposter</h4>
            </div>
            <div class="modal-body">
              <p>Imposter is basically a clone of "Spyfall", but with different, more diverse scenarios.</p><br>
              <h5>How to Play</h5>
              <p>When the game starts, you are either shown a special scenario and your role in said scenario or you
              are the randomly-chosen Imposter!</p><br>
              <p>If you're <strong>not</strong> the Imposter, your job is to find who is in the same scenario as you
              without tipping off the Imposter, who can guess the scenario from a list if you're too specific. Take turns
              asking questions, and if someone seems like they don't belong, accuse them of being the Imposter.  If the
              players <strong>unanimously</strong> decide that one person is the Imposter, the game ends.  If you've
              correctly identified the Imposter, you win, but if you chose the wrong person, the Imposter wins.  If the time
              runs out, a vote is immediately called.</p><br>
              <p>If you're the Imposter, you've gotta blend in! Use deductive reasoning to choose the specific scenario that
              your friends are in and you win. You can also win by letting the timer run out and convincing the rest of the players
              to vote for someone else.</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div id="pistolwhip-modal" class="modal fade" role="dialog">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">About Pistolwhip (WIP)</h4>
            </div>
            <div class="modal-body">
              <p>Pistolwhip is a work in progress, beyotch.</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>

  <!-- Forms ----------------------->

      <!-- Imposter -->
      <div class="imposter-new-view new-view">
        <button class="btn btn-default back-btn">Back</button>
        <h4 class="nameprompt-header" align="center">What's your name?</h4>
        <form name="imposter-new-prompt" class="form-horizontal game-prompt" id="imposter-new-prompt" onsubmit="event.preventDefault(); return imposterNewGame();">
          <input type="hidden" name="gametitle" value="imposter">
          <input type="text" name="namebox" class="form-control nameprompt-input" id="imposter-new-namebox" maxlength="16" placeholder="16 characters max" autofocus required>
          <div class="make-submit">
            <button type="submit" name="imposter-new-submit" class="btn btn-primary" id="imposter-new-submit">Start Game!</button>
          </div>
        </form>
      </div>
      <div class="imposter-join-view join-view">
        <button class="btn btn-default back-btn">Back</button>
        <form name="imposter-join-prompt" class="form-horizontal game-prompt" id="imposter-join-prompt" onsubmit="event.preventDefault(); return imposterJoinGame();">
          <input type="hidden" name="gametitle" value="imposter">
          <h4 class="nameprompt-header" align="center">Choose a name</h4>
          <input type="text" name="namebox" class="form-control" id="imposter-join-namebox" maxlength="16" placeholder="16 characters max" autofocus required>
          <h4 class="nameprompt-header" align="center">Enter game code</h4>
          <input type="text" name="gcbox" class="form-control" id="imposter-join-gcbox" maxlength="6" autofocus required>
          <div class="join-submit">
            <button type="submit" name="imposter-join-submit" class="btn btn-primary" id="imposter-join-submit">Join Game!</button>
          </div>
        </form>
      </div>
      <!-- PistolWhip -->
      <div class="pistolwhip-new-view new-view">
        <button class="btn btn-default back-btn">Back</button>
        <h4 class="nameprompt-header" align="center">What's your name?</h4>
        <form name="pistolwhip-new-prompt" class="form-horizontal game-prompt" id="pistolwhip-new-prompt" onsubmit="event.preventDefault(); return pistolwhipNewGame();">
          <input type="hidden" name="gametitle" value="pistolwhip">
          <input type="text" name="namebox" class="form-control" id="pistolwhip-new-namebox" maxlength="16" placeholder="16 characters max" autofocus required>
          <div class="make-submit">
            <button type="submit" name="make-game-submit" class="btn btn-primary" id="pistolwhip-new-submit">Start Game!</button>
          </div>
        </form>
      </div>
      <!-- Options -->
      <div class="options-view">
        <button class="btn btn-default back-btn">Back</button>
        <h3 align="center">Eh, no options yet m9</h3>
      </div>
    </div>
  </div>
</body>
</html>
<script type="text/javascript" src="/scripts/commonFuncs.js"></script>
<script type="text/javascript">
var imposterNewGame = function() {};
var imposterJoinGame = function() {};
var pistolwhipNewGame = function() {};
$(document).ready(function() {
  var gameView = 0;
  var viewChangeCD = false;
  $('.lm-imposter').stop().animate({color: 'white'}, 500);
  //Menu item listeners
  $('.lm-imposter').on('mousedown tap', function() {
    refreshGameChoice(0);
  });
  $('.lm-pistolwhip').on('mousedown tap', function() {
    refreshGameChoice(1);
  });
  $('.lm-options').on('mousedown tap', function() {
    refreshGameChoice(2);
  });
  //Button listeners
  $('.mv-btn').on('mousedown tap', function() {
    $(this).css({backgroundColor: '#0073e6'});
    setTimeout(function() {
      $('.mv-btn').css({backgroundColor: '#808080'});
    }, 100);
  });
  $('.new-btn').on('mousedown tap', function() {
    let s = '.imposter-new-view';
    if(gameView == 1) {
      s = '.pistolwhip-new-view';
    }
    $('.menu-view, .mvbtn-area').fadeOut(function() {
      $(s).fadeIn(250);
    });
  });
  $('.join-btn').on('mousedown tap', function() {
    $('.menu-view, .mvbtn-area').fadeOut(function() {
      $('.imposter-join-view').fadeIn(250);
    });
  });
  $('.about-btn').on('mousedown tap', function() {
    if(gameView == 0) {
      $('#imposter-modal').modal('show');
    } else {
      $('#pistolwhip-modal').modal('show');
    }
  });
  $('.back-btn').on('mousedown tap', function() {
    $('.new-view, .join-view').fadeOut(100, function () {
      $('.menu-view, .mvbtn-area').fadeIn(250);
    });
  });
  //Form handling
  imposterNewGame = function() {
    var pName = $('#imposter-new-namebox').val();
    var pl = {
      'name': pName,
      'gametitle': 'imposter'
    };
    $.ajax({
      type: 'POST',
      url: window.location + 'scripts/makeGame',
      contentType: 'application/json',
      dataType: 'json',
      cache: false,
      data: JSON.stringify(pl),
      beforeSend: function(x) {
        if (x && x.overrideMimeType) {
          console.log('Overriding MIME type to UTF8');
          x.overrideMimeType("application/j-son;charset=UTF-8");
        }
      },
      success: function(data, status, jqreq) {
        console.log('Creating new Imposter game...');
        var newurl = window.location.toString().replace('/gamesuite/', '');
        if(data.reqstatus == 'ready') {
          newurl = newurl + '/imposter/' + data.gamecode;
          window.location.href = newurl;
        }
        return true;
      },
      error: function(jqreq, status, err) {
        console.log(err);
        alert(err);
        console.log(jqreq);
        return false;
      }
    });
  };
  imposterJoinGame = function() {
    var pName = $('#imposter-join-namebox').val();
    var pGameCode = $('#imposter-join-gcbox').val();
    var pl = {
      'name': pName,
      'gamecode': pGameCode,
      'gametitle': 'imposter'
    };
    $.ajax({
      type: 'POST',
      url: window.location + 'scripts/joinGame',
      contentType: 'application/json',
      dataType: 'json',
      cache: false,
      data: JSON.stringify(pl),
      beforeSend: function(x) {
        if (x && x.overrideMimeType) {
          console.log('Overriding MIME type to UTF8');
          x.overrideMimeType("application/j-son;charset=UTF-8");
        }
      },
      success: function(data, status, jqreq) {
        if(data.reqstatus == 'error') {
          console.log('Error in joining Imposter.');
          alert(data.error);
          return;
        }
        console.log('Joining Imposter game ' + data.gamecode + '...');
        var newurl = window.location.toString().replace('/gamesuite/', '');
        if(data.reqstatus == 'ready') {
          newurl = newurl + '/imposter/' + data.gamecode;
          window.location.href = newurl;
        }
        return true;
      },
      error: function(jqreq, status, err) {
        console.log(err);
        alert(err);
        console.log(jqreq);
        return false;
      }
    });
  };
  //View changing
  function refreshGameChoice(id) {
    if(viewChangeCD === false) {
      gameView = id;
      let n = '.lm-li' + id;
      let p = 115 + (61 * id);
      let q = p + 'px';
      let r = 'none';
      $('.lobby-menu li').stop().animate({color: '#cccccc'}, 250);
      $(n).stop().animate({color: 'white'}, 500);
      $('.lm-selector').stop().animate({top: q}, 400);
      $('.gd').hide(function() {
        setTimeout(function() {
          if(id < 2 && $('.mv-btns').css('display') == 'none') {
            $('.mv-btns').fadeIn(200);
          }
          if(id == 0) {
            $('.gd-imposter').fadeIn(300);
            if($('.join-btn').css('display') == 'none') {
              $('.join-btn').fadeIn(200);
            }
            $('.mv-btns').css({'grid-template-columns': '1fr 1fr 1fr'});
          } else if(id == 1) {
            $('.gd-pistolwhip').fadeIn(300);
            $('.join-btn').fadeOut(200);
            setTimeout(function() {
              $('.mv-btns').css({'grid-template-columns': '1fr 1fr'});
            }, 200);
          } else if(id == 2) {
            $('.gd-options').fadeIn(300);
            $('.mv-btns').fadeOut(200);
          }
        }, 100);
      });
      viewChangeCD = true;
      setTimeout(function() {
        viewChangeCD = false;
      }, 800);
    }
  }
});
</script>
